---
title: "Antigravity の推奨 Deny List Terminal Commands 設定"
emoji: "🛡️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["antigravity", "ai", "セキュリティ", "開発環境"]
published: true
---

## はじめに

Antigravity（Google のAIコーディングアシスタント）には、エージェントが自動でターミナルコマンドを実行できる「Always Proceed」や「Agent Decides」モードがあります。この機能は便利な反面、危険なコマンドが意図せず実行されるリスクもあります。

そこで活用したいのが **Deny List Terminal Commands** 設定です。ここに登録したコマンドパターンは、エージェントが自動実行できなくなります。

この記事では、おすすめの Deny List 設定を紹介します。

## Deny List Terminal Commands とは

**ユーザ設定（Cmd + ,）** → **Terminal Execution Policy** から設定できる、エージェントによる自動実行をブロックするコマンドのリストです。

重要な点として、**Antigravity はプレフィックスマッチング**を採用しています。たとえば `rm` を登録すると、`rm temp_file.txt` のような安全なバリエーションまでブロックされるため、登録するコマンドの粒度に注意が必要です。

## 推奨 Deny List

以下のパターンを1行ずつ追加することをおすすめします。

| コマンドパターン | 危険な理由 |
| :--- | :--- |
| `sudo` | 特権昇格により、他のすべての制限をバイパスできてしまう |
| `rm -rf` | 再帰的にファイルを削除する定番コマンド。ワークスペースが消える高リスク |
| `mkfs` | パーティションのフォーマットに使用。ドライブの全データが消える可能性 |
| `dd` | 低レベルのデータ複製ツール。誤用するとハードドライブ全体を上書きできる |
| `chmod -R 777` | 全ユーザーに読み書き実行権限を開放してしまう重大なセキュリティホール |
| `curl \| sh` | 外部スクリプトをダウンロードして即実行するパターンを防ぐ |
| `env` | 環境変数（APIキー等の機密情報が含まれることが多い）を一覧表示させない |
| `history` | 過去に入力した機密コマンドやパスワードが平文で露出する恐れがある |
| `shutdown` | 誤って（または意図的に）マシンをシャットダウンされるのを防ぐ |
| `reboot` | 同上。エージェントによる予期せぬ再起動を防ぐ |

## セキュリティをさらに高める Tips

### プレフィックスマッチングの注意点

`npx` を Deny List に入れると、`npx playwright` など有用なコマンドも全てブロックされます。制限が強すぎる場合は、**Allow List** に特定のサブコマンドを追加して例外的に許可する方法も検討してください。

### Terminal Sandboxing を有効にする（macOS）

設定から「**Enable Terminal Sandboxing**」をオンにすると、Apple の「Seatbelt」メカニズムを用いて、エージェントのファイルシステムアクセスを現在のワークスペースのみに制限できます。コマンドレベルの制御と組み合わせることで多層防御が実現できます。

### Strict Mode を活用する

高リスクなプロジェクトでは **Strict Mode** を有効にすることをおすすめします。このモードを有効にすると、すべてのターミナルコマンドが「Request Review」（人が承認）になり、Allow List の設定も無視されます。意図しない自動実行を完全に防げます。

### 「Agent Decides」モードのリスク

「Agent Decides」機能の使用で意図しない挙動が報告されています。基本は「**Request Review**」モードで運用し、`ls`・`git status`・`npm test` など信頼できる繰り返し操作のみを Allow List に登録するのが安全です。

## まとめ

Antigravity の Deny List Terminal Commands は、AIエージェントの自動実行から身を守るための重要な設定です。

- **最低限ブロックすべき**: `sudo`、`rm -rf`、`dd`、`mkfs`
- **機密情報保護のため**: `env`、`history`
- **多層防御**: Terminal Sandboxing と組み合わせる
- **高リスク作業時**: Strict Mode を一時的に有効化

設定は **Cmd + ,** → **Terminal Execution Policy** から手軽に変更できるので、自分の開発スタイルに合わせてカスタマイズしてみてください。
